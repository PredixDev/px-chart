<!doctype html>

<html ng-app="demo">
<head>
  <title>px-time-series-chart Demo</title>

  <!-- Requires Webcomponents.js polyfill is provided by the page for browsers that don't support html imports -->
  <script src="../webcomponentsjs/webcomponents.js"></script>

  <!-- Import custom element. Note: see comment about relative paths to dependencies in the *.html file referenced below -->
  <link rel="import" href="../px-theme/px-theme.html"/>
  <link rel="import" href="../iron-ajax/iron-ajax.html"/>
  <link rel="import" href="px-time-series.html"/>
  <link rel="import" href="px-time-series-chart.html"/>
  <link rel="import" href="px-chart-series.html"/>
  
  <style is="x-style">
    html {
      height: 100%;
      font-size:0.9375em;
    }
    body {
      height: 100%;
      margin: 0;
    }
    .demo {
      padding: 1rem;
    }
  </style>

</head>

<body ng-controller="DemoController">
  
  <article class="demo" role="article">
    <h3>Demo</h3>
    <p>Although related, examples are /not/ the same as the test fixtures. Tests are tests, examples are examples.</p>
    <p>
      Also see the
      <a href="index.html">documentation</a>
      and the
      <a href="test/fixture.html">UI test fixture</a>.
    </p>
    <p>
      Checkout the Graph below, You will
      <span style="color:red">&hearts;</span>
      it.
    </p>
  </article>

  ALL-IN-ONE COMPONENT:
  <px-time-series showyaxisunits
                  x-axis-label="time"
                  y-axis-label="values">
  </px-time-series>


  <iron-ajax
      class="for-all-in-one"
      auto="false"
      url="../demo-data/aviation/_all.json"
      handleas="json"></iron-ajax>
  
  <div class="demo">
    <p>
      <button onclick="addSeries('Core Vibe Rear Cruise')">Add Series A</button>
      <button onclick="removeSeries('Core Vibe Rear Cruise')">Remove Series A</button>
      <button onclick="addSeries('Fan Vibration Cruise')">Add Series B</button>
      <button onclick="removeSeries('Fan Vibration Cruise')">Remove Series B</button>
    </p>
  </div>

  SEPARATE CHART AND SERIES COMPONENTS:
  <px-time-series-chart showyaxisunits
                  x-axis-label="time"
                  y-axis-label="values">
    <px-chart-series name="core-vibe-rear-cruise">
      <iron-ajax
          url="../demo-data/aviation/core-vibe-rear-cruise.json"
          handleas="json"
          on-response="{{parent.setSeriesObj}}"></iron-ajax>
    </px-chart-series>
    <px-chart-series name="fan-vibe-fwd-cruise">
      <iron-ajax
          url="../demo-data/aviation/fan-vibration-cruise.json"
          handleas="json"
          on-response="{{setSeriesObj}}"></iron-ajax>
    </px-chart-series>
  </px-time-series-chart>

<script>


    var cachedSeriesA, cachedSeriesB;

    var isDisplayed = {
      "Core Vibe Rear Cruise": true,
      "Fan Vibration Cruise": true
    };

    var queries = [
      {
        "sample_size": 14368,
        "results": []
      }
    ];


    function addSeries(seriesString) {
      if (!isDisplayed[seriesString]) {
        var series;
        if (seriesString === "Core Vibe Rear Cruise") {
          series = cachedSeriesA;
        }
        else if (seriesString === 'Fan Vibration Cruise') {
          series = cachedSeriesB;
        }
        isDisplayed[seriesString] = true;
        queries[0].results.push(series);
        updateAllInOneTimeSeries();
      }
    }

    function removeSeries (seriesString) {
      isDisplayed[seriesString] = false;
      queries[0].results = [];
      if(isDisplayed["Core Vibe Rear Cruise"]) {
        queries[0].results.push(cachedSeriesA);
      }
      if(isDisplayed["Fan Vibration Cruise"]) {
        queries[0].results.push(cachedSeriesB);
      }
      updateAllInOneTimeSeries();
    }

    function updateAllInOneTimeSeries() {
      var timeSeriesComp = document.querySelector("px-time-series");

      //cheating...make sure Polymer sees a new "queries" object each time so the observer fires.
      queries = [].concat(queries);

      timeSeriesComp.queries = queries;
    }


    function handleAviationDataLoadForAllInOneChart(aviationData) {
      //convert the aviation data into kairosdb format.  TODO: assume an abstraction layer so we don't pin ourselves to kairosdb format
      cachedSeriesA = {name: "Core Vibe Rear Cruise", values: aviationData.CoreVibeRearCruise.series};
      cachedSeriesB = {name: "Fan Vibration Cruise", values: aviationData.FanVibeFwdCruise.series};
      queries[0].results.push(cachedSeriesA);
      queries[0].results.push(cachedSeriesB);
      updateAllInOneTimeSeries();
    }

window.addEventListener('WebComponentsReady', function() {
  var ironAjaxEl = document.querySelector("iron-ajax.for-all-in-one");
  ironAjaxEl.addEventListener("response", function(evt) {
    handleAviationDataLoadForAllInOneChart(evt.detail);
  });
  ironAjaxEl.generateRequest();
});


</script>
</body>
</html>
