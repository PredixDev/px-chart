<!doctype html>

<html>
<head>
  <title>px-ts-chart Demo</title>

  <!-- Requires Webcomponents.js polyfill is provided by the page for browsers that don't support html imports -->
  <script src="../webcomponentsjs/webcomponents.js"></script>

  <!-- Import custom element. Note: see comment about relative paths to dependencies in the *.html file referenced below -->
  <link rel="import" href="../px-theme/px-theme.html"/>
  <link rel="import" href="../iron-ajax/iron-ajax.html"/>
  <link rel="import" href="px-ts-chart.html"/>

  <style is="x-style">
    html {
      height: 100%;
      font-size:0.9375em;
    }
    body {
      height: 100%;
      margin: 0;
    }
  </style>

</head>

<body>

<section class="full-config-example">
  <h1>Full Config</h1>
  <button onclick="refresh()">Refresh</button>
  <button onclick="addSeries('core-vibe-rear-cruise', '../demo-data/aviation/core-vibe-rear-cruise.json')">Add Core Vibration Series</button>
  <button onclick="removeSeries('core-vibe-rear-cruise')">Remove Core Vibration Series</button>
  <px-ts-chart>
    <px-ts-chart-controls data-controls></px-ts-chart-controls>
    <px-chart-yaxis offset="0"></px-chart-yaxis>
    <px-chart-yaxis opposite="true" offset="-2.5"></px-chart-yaxis>
    <px-chart-series name="fan-vibration-cruise" axis-index="1">
      <iron-ajax
          url="../demo-data/aviation/fan-vibration-cruise.json"
          handleas="json"></iron-ajax>
    </px-chart-series>
    <px-chart-series name="hpt-acc-position-cruise" axis-index="2">
      <iron-ajax
          url="../demo-data/aviation/hpt-acc-position-cruise.json"
          handleas="json"></iron-ajax>
    </px-chart-series>
  </px-ts-chart>

</section>

<section class="minimal-config-example">
  <h1>Minimal Config</h1>
  <px-ts-chart>
    <px-chart-series name="fan-vibration-cruise"></px-chart-series>
  </px-ts-chart>
</section>

<script>
  //For minimal config demo only...grab some data to shove into minimal config from the outside...
  var ironAjaxEl = document.createElement("iron-ajax");
  ironAjaxEl.url = "../demo-data/aviation/fan-vibration-cruise.json";
  ironAjaxEl.handleas = "json";
  ironAjaxEl.addEventListener("response", function(evt) {
    var minimalConfigChartSeries = document.querySelector('.minimal-config-example px-chart-series');
    minimalConfigChartSeries.data = evt.detail.series;
  });

  ironAjaxEl.generateRequest();


  function refresh(evt){
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange=function() {
      if (xmlhttp.readyState==4 && xmlhttp.status==200) {
        var tsChart = Polymer.dom(document).querySelector('.full-config-example px-chart-series');
        tsChart.addOrUpdateSeries('fan-vibration-cruise', JSON.parse(xmlhttp.responseText), 0, false);
      }
    }
    xmlhttp.open("GET","../demo-data/aviation/fan-vibration-cruise2.json",true);
    xmlhttp.send();
  }


  function addSeries(seriesId, seriesObjUrl) {
    var timeSeriesComp = document.querySelector(".full-config-example px-ts-chart");
    if (timeSeriesComp.chart.get(seriesId)) {
      console.log("series " + seriesId + " already exists on chart.");
    }
    else {
      var ironAjaxEl = document.createElement("iron-ajax");
      ironAjaxEl.url = seriesObjUrl;
      ironAjaxEl.handleas = "json";
      ironAjaxEl.addEventListener("response", function(evt) {
        timeSeriesComp.addOrUpdateSeries(seriesId, evt.detail.series, /*y-axis index*/3, /*noReflow*/false);
      });

      ironAjaxEl.generateRequest();
    }
  }

  function removeSeries (seriesId) {
    var timeSeriesComp = document.querySelector(".full-config-example px-ts-chart");
    if (timeSeriesComp.chart.get(seriesId)) {
      timeSeriesComp.removeSeries(seriesId);
    }
    else {
      console.log("series " + seriesId + " does not exist on chart.");
    }
  }

</script>
</body>
</html>
